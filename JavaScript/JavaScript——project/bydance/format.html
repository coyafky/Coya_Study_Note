#!/jcode/lang/markdown https://xitu.github.io/jcode-languages/dist/lang-webslides.json

<section class="bg-gradient-h">
  :.background
  :html
    <div class="logo">
     <img src="https://p2.ssl.qhimg.com/t01562ef7e76734210d.png">
    </div>
  :.warp.aligncenter[style="width:100%"]
    # 如何写 __好__ JavaScript

    ## 月影{$.author}

    字节跳动前端团队 | 青训营社区{$.copyright}
</section>
<section class="slide-top bg-gradient-h">
  :.background
  :.warp.aligncenter
    ## 什么才是好的JavaScript代码？
    :.wrap[style="padding-top:50px"]
      ![](https://p0.ssl.qhimg.com/t016926978966b5b4b4.jpg)
</section>
<section class="bg-gradient-h">
  :.background
  :.warp[style="width:90%;margin:auto"]
    ## 写好JS的一些原则
    {^.flexblock.features}
    - ### {@filetype-css?fill=white}各司其责
      <p>让HTML、CSS和JavaScript职能分离。</p>
    - ### {@envelope-paper-heart?fill=white}组件封装
      <p>好的UI组件具备正确性、扩展性、复用性。</p>
    - ### {@funnel?fill=white}过程抽象
      <p>应用函数式编程思想。</p>
</section>
<section class="bg-gradient-h">
  :.background
  :.wrap
    :.grid.vertical-align
      :.column
        ## 深夜食堂

        写一段JS，控制一个网页，让它支持浅色和深色两种浏览模式。
        如果是你来实现，你会怎么做？
      :.column
        :html
          <img class="canteen" src="https://p5.ssl.qhimg.com/t015b445bef7dede221.jpg" style="max-width: 400px">
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [版本一](https://code.juejin.cn/pen/7108183451764785189){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;"]
    :.grid
      :.column
        ```js
          const btn = document.getElementById('modeBtn');
          btn.addEventListener('click', (e) => {
            const body = document.body;
            if(e.target.innerHTML === '🌞') {
              body.style.backgroundColor = 'black';
              body.style.color = 'white';
              e.target.innerHTML = '🌜';
            } else {
              body.style.backgroundColor = 'white';
              body.style.color = 'black';
              e.target.innerHTML = '🌞';
            }
          });
        ```
      :.column
        ### 讨论
        
        这个版本有什么问题？
        
        如果你来优化，你会怎么做？
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [版本二](https://code.juejin.cn/pen/7108183934399152165){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;"]
    :.grid
      :.column
        ```js
          const btn = document.getElementById('modeBtn');
          btn.addEventListener('click', (e) => {
            const body = document.body;
            if(body.className !== 'night') {
              body.className = 'night';
            } else {
              body.className = '';
            }
          });
        ```
      :.column
        ### 讨论
        
        这一版比起上一版好在哪里？
        
        还有没有其他的方案？
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [版本三](https://code.juejin.cn/pen/7108184672710066212){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;"]
    :.grid
      :.column
        ```html
          <input id="modeCheckBox" type="checkbox">
          <div class="content">
            <header>
              <label id="modeBtn" for="modeCheckBox"></label>
              <h1>深夜食堂</h1>
            </header>
            <main>
              <div class="pic">
                <img src="https://p2.ssl.qhimg.com/t0120cc20854dc91c1e.jpg">
              </div>
              <div class="description">
                <p>
                    这是一间营业时间从午夜十二点到早上七点的特殊食堂。这里的老板，不太爱说话，却总叫人吃得热泪盈
                    眶。在这里，自卑的舞蹈演员偶遇隐退多年舞界前辈，前辈不惜讲述自己不堪回首的经历不断鼓舞年轻人，最终令其重拾自信；轻言绝交的闺蜜因为吃到共同喜爱的美食，回忆起从前的友谊，重归于好；乐观的绝症患者遇到同命相连的女孩，两人相爱并相互给予力量，陪伴彼此完美地走过了最后一程；一味追求事业成功的白领，在这里结交了真正暖心的朋友，发现真情比成功更有意义。食物、故事、真情，汇聚了整部剧的主题，教会人们坦然面对得失，对生活充满期许和热情。每一个故事背后都饱含深情，情节跌宕起伏，令人流连忘返 [6]  。
                </p>
              </div>
            </main>
          </div>
        ```
      :.column
        ```css
          #modeCheckBox {
            display: none;
          }

          #modeCheckBox:checked + .content {
            background-color: black;
            color: white;
            transition: all 1s;
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 深夜食堂——结论
  :.wrap[style="margin-top:50px;max-width:1300px;"]
    :.grid.vertical-align
      :.column
        ![](https://p1.ssl.qhimg.com/t0121cc1e818e11d365.png)
      :.column
        - HTML/CSS/JS 各司其责
        - 应当避免不必要的由 JS 直接操作样式
        - 可以用 class 来表示状态
        - 纯展示类交互寻求零 JS 方案
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 组件封装
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### [例子](https://code.juejin.cn/pen/7108185460320501774){$[target=_blank]}

        用原生 JS 写一个电商网站的轮播图，应该怎么实现？
      :.column.img
        ![](https://p1.ssl.qhimg.com/t01389f9944ece6306b.png)

        ![](https://p2.ssl.qhimg.com/t01f1feb13cad838bbe.png)
    :.footer
      组件是指Web页面上抽出来一个个包含模版（HTML）、功能（JS）和样式（CSS）的单元。好的组件具备封装性、正确性、扩展性、复用性。
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 结构：HTML
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ```html
            <div id="my-slider" class="slider-list">
              <ul>
                <li class="slider-list__item--selected">
                  <img src="https://p5.ssl.qhimg.com/t0119c74624763dd070.png"/>
                </li>
                <li class="slider-list__item">
                  <img src="https://p4.ssl.qhimg.com/t01adbe3351db853eb3.jpg"/>
                </li>
                <li class="slider-list__item">
                  <img src="https://p2.ssl.qhimg.com/t01645cd5ba0c3b60cb.jpg"/>
                </li>
                <li class="slider-list__item">
                  <img src="https://p4.ssl.qhimg.com/t01331ac159b58f5478.jpg"/>
                </li>
              </ul>
            </div>
        ```
      :.column
        ### 结构

        轮播图是一个典型的列表结构，我们可以使用无序列表`ul`元素来实现。
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 表现：CSS
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ```css
          #my-slider{
            position: relative;
            width: 790px;
          }

          .slider-list ul{
            list-style-type:none;
            position: relative;
            padding: 0;
            margin: 0;
          }

          .slider-list__item,
          .slider-list__item--selected{
            position: absolute;
            transition: opacity 1s;
            opacity: 0;
            text-align: center;
          }

          .slider-list__item--selected{
            transition: opacity 1s;
            opacity: 1;
          }
        ```
      :.column
        ### 表现

        - 使用 CSS 绝对定位将图片重叠在同一个位置
        - 轮播图切换的状态使用修饰符（modifier）
        - 轮播图的切换动画使用 CSS transition
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [行为：JS](https://code.juejin.cn/pen/7108186682775568420){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ```js
          class Slider{
            constructor(id){
              this.container = document.getElementById(id);
              this.items = this.container
              .querySelectorAll('.slider-list__item, .slider-list__item--selected');
            }
            getSelectedItem(){
              const selected = this.container
                .querySelector('.slider-list__item--selected');
              return selected
            }
            getSelectedItemIndex(){
              return Array.from(this.items).indexOf(this.getSelectedItem());
            }
            slideTo(idx){
              const selected = this.getSelectedItem();
              if(selected){ 
                selected.className = 'slider-list__item';
              }
              const item = this.items[idx];
              if(item){
                item.className = 'slider-list__item--selected';
              }
            }
            slideNext(){
              const currentIdx = this.getSelectedItemIndex();
              const nextIdx = (currentIdx + 1) % this.items.length;
              this.slideTo(nextIdx);
            }
            slidePrevious(){
              const currentIdx = this.getSelectedItemIndex();
              const previousIdx = (this.items.length + currentIdx - 1)
                % this.items.length;
              this.slideTo(previousIdx);  
            }
          }

          const slider = new Slider('my-slider');
          slider.slideTo(3);
        ```
      :.column
        ### 行为：API
        ![](https://p5.ssl.qhimg.com/t01a9e457b71142d953.png)
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [行为：JS](https://code.juejin.cn/pen/7108187834598555656){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ```html
          <a class="slide-list__next"></a>
          <a class="slide-list__previous"></a>
          <div class="slide-list__control">
            <span class="slide-list__control-buttons--selected"></span>
            <span class="slide-list__control-buttons"></span>
            <span class="slide-list__control-buttons"></span>
            <span class="slide-list__control-buttons"></span>
          </div>
        ```
        ```js
          const detail = {index: idx}
          const event = new CustomEvent('slide', {bubbles:true, detail})
          this.container.dispatchEvent(event)
        ```
      :.column
        ### 行为：控制流
        - 使用自定义事件来解耦。
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 组件封装
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 总结：基本方法
        - 结构设计
        - 展现效果
        - 行为设计
          1. API （功能）
          1. Event （控制流）
      :.column
        ### 思考：改进空间？

        如果让你来重构这个轮播图组件，你会怎么做？

        ![](https://p2.ssl.qhimg.com/t01f1feb13cad838bbe.png)
    :.footer
      组件是指Web页面上抽出来一个个包含模版（HTML）、功能（JS）和样式（CSS）的单元。好的组件具备封装性、正确性、扩展性、复用性。
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [重构：插件化](https://code.juejin.cn/pen/7108191112094973989){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 解耦
          - 将控制元素抽取成插件
          - 插件与组件之间通过**依赖注入**方式建立联系
      :.column
        ```js
          function pluginController(slider){
            const controller = slider.container.querySelector('.slide-list__control');
            if(controller){
              const buttons = controller.querySelectorAll('.slide-list__control-buttons, .slide-list__control-buttons--selected');
              controller.addEventListener('mouseover', evt=>{
                const idx = Array.from(buttons).indexOf(evt.target);
                if(idx >= 0){
                  slider.slideTo(idx);
                  slider.stop();
                }
              });

              controller.addEventListener('mouseout', evt=>{
                slider.start();
              });

              slider.addEventListener('slide', evt => {
                const idx = evt.detail.index
                const selected = controller.querySelector('.slide-list__control-buttons--selected');
                if(selected) selected.className = 'slide-list__control-buttons';
                buttons[idx].className = 'slide-list__control-buttons--selected';
              });
            }  
          }

          function pluginPrevious(slider){
            const previous = slider.container.querySelector('.slide-list__previous');
            if(previous){
              previous.addEventListener('click', evt => {
                slider.stop();
                slider.slidePrevious();
                slider.start();
                evt.preventDefault();
              });
            }  
          }

          function pluginNext(slider){
            const next = slider.container.querySelector('.slide-list__next');
            if(next){
              next.addEventListener('click', evt => {
                slider.stop();
                slider.slideNext();
                slider.start();
                evt.preventDefault();
              });
            }  
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [重构：模板化](https://code.juejin.cn/pen/7108191503301754910){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 解耦
          - 将HTML模板化，更易于扩展

          ![](https://p1.ssl.qhimg.com/t0196498fb325ccb123.png)
      :.column
        ```js
          class Slider{
            constructor(id, opts = {images:[], cycle: 3000}){
              this.container = document.getElementById(id);
              this.options = opts;
              this.container.innerHTML = this.render();
              this.items = this.container.querySelectorAll('.slider-list__item, .slider-list__item--selected');
              this.cycle = opts.cycle || 3000;
              this.slideTo(0);
            }
            render(){
              const images = this.options.images;
              const content = images.map(image => `
                <li class="slider-list__item">
                  <img src="${image}"/>
                </li>    
              `.trim());
              
              return `<ul>${content.join('')}</ul>`;
            }
            ...
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [组件框架](https://code.juejin.cn/pen/7108185460320501774){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 抽象
          - 将组件通用模型抽象出来

          ![](https://p4.ssl.qhimg.com/t0152a5c963a9854531.png)
      :.column
        ```js
          class Component{
            constructor(id, opts = {name, data:[]}){
              this.container = document.getElementById(id);
              this.options = opts;
              this.container.innerHTML = this.render(opts.data);
            }
            registerPlugins(...plugins){
              plugins.forEach(plugin => {
                const pluginContainer = document.createElement('div');
                pluginContainer.className = `.${name}__plugin`;
                pluginContainer.innerHTML = plugin.render(this.options.data);
                this.container.appendChild(pluginContainer);
                
                plugin.action(this);
              });
            }
            render(data) {
              /* abstract */
              return ''
            }
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 组件封装
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 总结
        - 组件设计的原则：封装性、正确性、扩展性、复用性
        - 实现组件的步骤：结构设计、展现效果、行为设计
        - 三次重构
          1. 插件化
          1. 模板化
          1. 抽象化（组件框架）
      :.column
        ### 思考：改进空间？

        这个组件是否还有进一步的改进空间？

        ![](https://p2.ssl.qhimg.com/t01f1feb13cad838bbe.png)
    :.footer
      组件是指Web页面上抽出来一个个包含模版（HTML）、功能（JS）和样式（CSS）的单元。好的组件具备封装性、正确性、扩展性、复用性。
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 过程抽象
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 过程抽象
        - 用来处理局部细节控制的一些方法
        - 函数式编程思想的基础应用

      :.column
        ![](https://p1.ssl.qhimg.com/t013bcb517ea0c6099a.png)
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## [例子](https://code.juejin.cn/pen/7108192324600987656){$[target=_blank]}
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 操作次数限制
        - 一些异步交互
        - 一次性的HTTP请求

      :.column
        ```js
          const list = document.querySelector('ul');
          const buttons = list.querySelectorAll('button');
          buttons.forEach((button) => {
            button.addEventListener('click', (evt) => {
              const target = evt.target;
              target.parentNode.className = 'completed';
              setTimeout(() => {
                list.removeChild(target.parentNode);
              }, 2000);
            });
          });
        ```
      
  :.wrap
    ![](https://p3.ssl.qhimg.com/t01bf4f137b09423c15.png)
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 高阶函数
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### Once
        
        为了能够让“只执行一次“的需求覆盖不同的事件处理，我们可以将这个需求剥离出来。这个过程我们称为**过程抽象**。
        
        ![](https://p0.ssl.qhimg.com/t013b14d9206cfdd078.png)
      :.column
        ```js
          function once(fn) {
            return function(...args) {
              if(fn) {
                const ret = fn.apply(this, args);
                fn = null;
                return ret;
              }
            }
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 高阶函数
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### HOF
        
        - 以函数作为参数
        - 以函数作为返回值
        - 常用于作为函数装饰器
      :.column
        ![](https://p5.ssl.qhimg.com/t01bfb54063461f49db.png)

        ```js
          function HOF0(fn) {
            return function(...args) {
              return fn.apply(this, args);
            }
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 常用高阶函数
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### HOF
        
        - [Once](https://code.juejin.cn/pen/7108192324600987656){$[target=_blank]}
        - [Throttle](https://code.juejin.cn/pen/7108192835387523103){$[target=_blank]}
        - [Debounce](https://code.juejin.cn/pen/7108193165005291527){$[target=_blank]}
        - [Consumer](https://code.juejin.cn/pen/7108194061986562079){$[target=_blank]} / [2](https://code.juejin.cn/pen/7108194420276592676){$[target=_blank]}
        - [Iterative](https://code.juejin.cn/pen/7108194830387249160){$[target=_blank]}
      :.column
        ![](https://p5.ssl.qhimg.com/t01bfb54063461f49db.png)

        ```js
          function HOF0(fn) {
            return function(...args) {
              return fn.apply(this, args);
            }
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 高阶函数
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 思考和讨论
        
        - 为什么要使用高阶函数？
      :.column
        ![](https://p3.ssl.qhimg.com/t0191115630682cd36f.png)

        ```js
          function HOF0(fn) {
            return function(...args) {
              return fn.apply(this, args);
            }
          }
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 编程范式
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 命令式与声明式
        
        ![](https://p2.ssl.qhimg.com/t01cf6fae692ce96bf0.png)
      :.column
        ```js
          let list = [1, 2, 3, 4];
          let mapl = [];
          for(let i = 0; i < list.length; i++) {
            mapl.push(list[i] * 2);
          }
        ```

        ```js
          let list = [1, 2, 3, 4];
          const double = x => x * 2;
          list.map(double);
        ```
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 编程范式
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 例子
        
        - [Toggle - 命令式](https://code.juejin.cn/pen/7108195101406396453){$[target=_blank]}
        - [Toggle - 声明式](https://code.juejin.cn/pen/7108195334366429221){$[target=_blank]}
        - [Toggle - 三态](https://code.juejin.cn/pen/7108195642467909663){$[target=_blank]}
      :.column
       ![](https://p1.ssl.qhimg.com/t011dc1f42fa4d4b3e5.png)
</section>
<section class="bg-gradient-h slide-top">
  :.background
  :.wrap
    ## 编程范式
  :.wrap[style="margin-top:50px;max-width:1300px;height:100%"]
    :.grid
      :.column
        ### 总结
        
        - 过程抽象 / HOF / 装饰器
        - 命令式 / 声明式
      :.column
       ![](https://p1.ssl.qhimg.com/t013bcb517ea0c6099a.png)
</section>
<section class="bg-gradient-h">
  :.background
  :html
    <div class="logo">
     <img src="https://p2.ssl.qhimg.com/t01562ef7e76734210d.png">
    </div>
  :.warp.aligncenter[style="width:100%"]
    ![](https://p0.ssl.qhimg.com/t0160aa76b4b39f6a91.png)

    字节跳动前端团队 | 青训营社区{$.copyright}
</section>